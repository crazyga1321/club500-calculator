<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CLUB500 — Калькулятор абонплаты</title>
<style>
  :root{
    --bg:#0b0f1a;
    --card:#0f1724;
    --accent:#7c3aed; /* club purple */
    --muted:#94a3b8;
    --glass: rgba(255,255,255,0.03);
    --success:#10b981;
  }
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#071024);color:#e6eef8}
  .wrap{max-width:980px;margin:28px auto;padding:20px}
  header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#5b21b6,#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700;color:white}
  h1{margin:0;font-size:20px}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02)}
  .inputs label{display:block;font-size:13px;color:var(--muted);margin-top:12px}
  .inputs input[type="number"], .inputs input[type="range"], .inputs select{width:100%;padding:8px 10px;margin-top:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#fff}
  .row{display:flex;gap:10px}
  .btn{background:var(--accent);color:white;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
  .muted{color:var(--muted);font-size:13px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px 10px;text-align:center;border-bottom:1px dashed rgba(255,255,255,0.03)}
  th{font-size:13px;color: #fff;background:linear-gradient(90deg,rgba(255,255,255,0.03),transparent)}
  td.small{font-size:13px;color:var(--muted)}
  .result{font-size:20px;font-weight:700;color:var(--success)}
  .chartArea{height:220px;margin-top:8px;background:linear-gradient(180deg, rgba(124,58,237,0.05), rgba(6,182,212,0.02));border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)}
  @media(max-width:900px){ .grid{grid-template-columns:1fr; } .card{padding:12px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">CL</div>
    <div>
      <h1>CLUB500 — Калькулятор роста депозита</h1>
      <p class="lead">Рост → затем абонплата в конце года (если депозит после роста ≥ порог). Покажи партнёрам красивую версию.</p>
    </div>
  </header>

  <div class="grid">
    <!-- main -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="muted">Параметры расчёта</div>
          <div style="font-weight:700;margin-top:4px">Настрой и делай скрин для партнёров</div>
        </div>
        <button class="btn" id="shareBtn">Скопировать ссылку</button>
      </div>

      <div class="inputs" style="margin-top:12px">
        <label>Начальный депозит ($)
          <input id="S0" type="number" value="4000" min="0" step="1">
        </label>

        <label>Годовая доходность (%) — например 200 = +200%
          <input id="r" type="number" value="200" step="1" min="0">
        </label>

        <label>Лет
          <select id="years">
            <option value="3" selected>3</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </label>

        <label>Абонплата (% от баланса конца года)
            <input type="number" id="feePct" class="form-control" value="10">
        </label>

        <label>Порог для взимания абонплаты ($)
          <input id="threshold" type="number" value="5000" min="0" step="1">
        </label>

        <label>Потолок абонплаты ($)
          <input id="cap" type="number" value="5000" min="0" step="1">
        </label>

        <div class="row" style="margin-top:12px">
          <button class="btn" id="calcBtn">Посчитать</button>
          <button id="resetBtn" style="background:#111827;color:#fff;border-radius:8px;padding:10px 12px;border:1px solid rgba(255,255,255,0.04)">Сброс</button>
        </div>
      </div>

      <div style="margin-top:14px">
        <div class="muted">Детализация по годам</div>
        <table id="table">
          <thead><tr><th>Год</th><th>Начало ($)</th><th>После роста ($)</th><th>Абонплата ($)</th><th>Итог ($)</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- right column: summary + chart -->
    <div>
      <div class="card">
        <div class="muted">Краткая сводка</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div>
            <div class="muted">Итоговый капитал</div>
            <div id="final" class="result">$0.00</div>
          </div>
          <div style="text-align:right">
            <div class="muted">Общий снятый fee</div>
            <div id="totalFees" style="font-weight:700">$0.00</div>
          </div>
        </div>

        <div class="chartArea" id="chartArea">График — тут показываются итоги по годам</div>

        <div style="margin-top:12px" class="muted">Совет: используй Excel-версию на встречах, а ссылку — отправляй для самостоятельного расчёта.</div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <div class="muted">Экспорт / Делёж</div>
        <div style="margin-top:8px">
          <button id="csvBtn" class="btn" style="background:#06b6d4">Скачать CSV</button>
          <div style="height:8px"></div>
          <button id="pptBtn" class="btn" style="background:#f59e0b">Скачать слайд (PNG)</button>
        </div>
      </div>
    </div>
  </div>

  <footer style="margin-top:18px;text-align:center;color:var(--muted);font-size:13px">
    CLUB500 • Встроенная логика: рост → проверка порога → снятие min(after*fee, cap)
  </footer>
</div>

<script>
  // Core logic
  function compute(params){
    let S = Number(params.S0);
    const r = Number(params.r); // percent
    const years = Number(params.years);
    const feePct = Number(params.feePct)/100;
    const threshold = Number(params.threshold);
    const cap = Number(params.cap);
    const rows = [];
    let totalFees = 0;

    for(let i=1;i<=years;i++){
      const start = S;
      const after = start * (1 + r/100);
      let fee = 0;
      if(after >= threshold){
        fee = Math.min(after * feePct, cap);
      }
      const end = after - fee;
      rows.push({
        year: i,
        start, after, fee, end
      });
      totalFees += fee;
      S = end;
    }
    return {rows, final: S, totalFees};
  }

  // UI helpers
  function fmt(n){ return (n===0 || isFinite(n)) ? '$' + Number(n).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2}) : '-'; }
  function clearTable(){ document.querySelector('#table tbody').innerHTML = ''; }
  function drawTable(rows){
    const tbody = document.querySelector('#table tbody');
    tbody.innerHTML = '';
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td class="small">${r.year}</td>
                      <td>${fmt(r.start)}</td>
                      <td>${fmt(r.after)}</td>
                      <td>${fmt(r.fee)}</td>
                      <td style="font-weight:700">${fmt(r.end)}</td>`;
      tbody.appendChild(tr);
    });
  }

  function drawChart(rows){
    const container = document.getElementById('chartArea');
    container.innerHTML = '';
    // simple inline svg sparkline
    const w = container.clientWidth - 20;
    const h = 160;
    const max = Math.max(...rows.map(r=>r.end));
    const min = Math.min(...rows.map(r=>r.end));
    const pad = 10;
    const pts = rows.map((r,i)=>{
      const x = pad + (i/(rows.length-1 || 1))*(w-2*pad);
      const y = h - pad - ((r.end - min)/( (max-min)||1))*(h-2*pad);
      return [x,y];
    });
    let svg = `<svg viewBox="0 0 ${w} ${h}" width="100%" height="${h}" xmlns="http://www.w3.org/2000/svg">`;
    // area
    svg += `<polyline fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#7c3aed'}" stroke-width="3" points="${pts.map(p=>p.join(',')).join(' ')}" stroke-linejoin="round" stroke-linecap="round"/>`;
    // dots + labels
    pts.forEach((p,i)=>{
      svg += `<circle cx="${p[0]}" cy="${p[1]}" r="3" fill="#fff"/>`;
    });
    svg += `</svg>`;
    container.innerHTML = svg;
  }

  // main calc
  function recalc(){
    const params = {
      S0: document.getElementById('S0').value,
      r: document.getElementById('r').value,
      years: document.getElementById('years').value,
      feePct: document.getElementById('feePct').value,
      threshold: document.getElementById('threshold').value,
      cap: document.getElementById('cap').value
    };
    const res = compute(params);
    drawTable(res.rows);
    document.getElementById('final').innerText = fmt(res.final);
    document.getElementById('totalFees').innerText = fmt(res.totalFees);
    drawChart(res.rows);
    return res;
  }

  // events
  document.getElementById('calcBtn').addEventListener('click', recalc);
  document.getElementById('S0').addEventListener('input', ()=>{ /* live if wanted */ });
  document.getElementById('resetBtn').addEventListener('click', ()=>{
    document.getElementById('S0').value = 4000;
    document.getElementById('r').value = 200;
    document.getElementById('years').value = 3;
    document.getElementById('feePct').value = 10;
    document.getElementById('threshold').value = 5000;
    document.getElementById('cap').value = 5000;
    recalc();
  });

  // CSV & share
  document.getElementById('csvBtn').addEventListener('click', ()=>{
    const res = recalc();
    let csv = 'Год,Начало,После роста,Абонплата,Итог\\n';
    res.rows.forEach(r=> csv += `${r.year},${r.start},${r.after},${r.fee},${r.end}\\n`);
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'calc_club500.csv'; a.click();
    URL.revokeObjectURL(url);
  });

  // fake share — copy current URL with params (works if hosted)
  document.getElementById('shareBtn').addEventListener('click', ()=>{
    const params = new URLSearchParams({
      S0:document.getElementById('S0').value,
      r:document.getElementById('r').value,
      years:document.getElementById('years').value,
      feePct:document.getElementById('feePct').value,
      threshold:document.getElementById('threshold').value,
      cap:document.getElementById('cap').value
    });
    const link = location.href.split('?')[0] + '?' + params.toString();
    navigator.clipboard?.writeText(link).then(()=> alert('Ссылка скопирована в буфер обмена'));
  });

  // load from url params
  (function loadFromParams(){
    const p = new URLSearchParams(location.search);
    if(p.has('S0')) document.getElementById('S0').value = p.get('S0');
    if(p.has('r')) document.getElementById('r').value = p.get('r');
    if(p.has('years')) document.getElementById('years').value = p.get('years');
    if(p.has('feePct')) document.getElementById('feePct').value = p.get('feePct');
    if(p.has('threshold')) document.getElementById('threshold').value = p.get('threshold');
    if(p.has('cap')) document.getElementById('cap').value = p.get('cap');
    recalc();
  })();

  // PPT button: quick screenshot fallback
  document.getElementById('pptBtn').addEventListener('click', ()=>{
    alert('Кнопка слайд-экспорта — можно подключить сервис для рендера. Пока скачивание CSV доступно.');
  });

</script>
</body>
</html>



